## SSH Local Port Forwarding

단일 포트 연결, database의 ssh 계정 정보를 알고 있을 때 활용 가능
![[Pasted image 20250714140552.png]]
```powershell
ssh -N -L 0.0.0.0:4455:172.16.50.217:445 database_admin@10.4.50.215
```

**smb 연결 시도**
```powershell
# Shares 나열
smbclient -p 4455 -L //192.168.50.63/ -U hr_admin --password=Welcome1234
# scripts Shares에 접속
smbclient -p 4455 //192.168.50.63/scripts -U hr_admin --password=Welcome1234
```

## SSH Dynamic Port Forwarding

동적인 IP와 포트로 연결, proxychains 사용하여야 함.
![[Pasted image 20250714140620.png]]

**Dynamic Port Forwarding 설정**
```powershell
ssh -N -D 0.0.0.0:9999 database_admin@10.4.50.215
```

**proxychains 설정 (socks5로 컨플루언스 주소 설정)**
```powershell
kali@kali:~$ tail /etc/proxychains4.conf
#       proxy types: http, socks4, socks5, raw
#         * raw: The traffic is simply forwarded to the proxy without modification.
#        ( auth types supported: "basic"-http  "user/pass"-socks )
#
[ProxyList]
# add proxy here ...
# meanwile
# defaults set to "tor"
socks5 192.168.50.63 9999
```

**proxychains를 사용하여 smb 및 nmap 스캔 사용**
```powershell
# smb 사용
proxychains smbclient -L //172.16.50.217/ -U hr_admin --password=Welcome1234
# nmap 사용
proxychains nmap -vvv -sT --top-ports=20 -Pn 172.16.50.217
```

## SSH Remote Port Forwarding

kali의 ssh를 사용하여 kali와 내부망 연결

![[Pasted image 20250714141359.png]]

**SSH 로 원격 포트 포워딩 설정 (-R 127.0.0.1)**
```powershell
ssh -N -R 127.0.0.1:2345:10.4.50.215:5432 kali@192.168.118.4
```

**포워딩된 상태로 postgres 접속**
```powershell
psql -h 127.0.0.1 -p 2345 -U postgres
```

## SSH Remote Dynamic Port Forwarding

원격 동적 포트 포워딩은 **OpenSSH 클라이언트 7.6 버전 이후**로만 사용할 수 있다.

**서버의 버전은 중요하지 않다**. `ssh -V`
![[Pasted image 20250714141440.png]]
![[Pasted image 20250714141505.png]]

**SSH 로 원격 동적 포트 포워딩 설정**
```jsx
ssh -N -R 9998 kali@192.168.118.4
```

**포트 9998 바인딩 확인**
```jsx
sudo ss -ntplu
```

**proxychains 설정**
```jsx
tail /etc/proxychains4.conf
#       proxy types: http, socks4, socks5, raw
#...
**socks5 127.0.0.1 9998**
```

**내부망에 nmap 실행**
```jsx
proxychains nmap -vvv -sT --top-ports=20 -Pn -n 10.4.50.64
```

## sshuttle

SSH 서버에 직접 액세스할 수 있고 내부 네트워크가 복잡할 때 사용가능. SSH 연결을 VPN화 시킴 (_sshuttle is a tool that turns an SSH connection into something like a VPN_).

**Confluence에서 SOCAT 연결**
```jsx
socat TCP-LISTEN:2222,fork TCP:10.4.50.215:22
```

**칼리에서 shuttle 연결**
```jsx
sshuttle -r database_admin@192.168.50.63:2222 10.4.50.0/24 172.16.50.0/24
```

**smb 연결**
```jsx
smbclient -L //172.16.50.217/ -U hr_admin --password=Welcome1234
```
→ VPN처럼 사용 가능